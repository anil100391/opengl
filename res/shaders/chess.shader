// -----------------------------------------------------------------------------
// -----------------------------------------------------------------------------
#shader vertex
#version 330 core

// -----------------------------------------------------------------------------
// -----------------------------------------------------------------------------
layout(location = 0) in vec4 position;
layout(location = 1) in vec2 texCoord;

// -----------------------------------------------------------------------------
// -----------------------------------------------------------------------------
uniform mat4 u_MVP;

// -----------------------------------------------------------------------------
// -----------------------------------------------------------------------------
void main()
{
    gl_Position = u_MVP * position;
};

// -----------------------------------------------------------------------------
// -----------------------------------------------------------------------------
#shader fragment
#version 330 core

// -----------------------------------------------------------------------------
// -----------------------------------------------------------------------------
layout(location = 0) out vec4 color;

// -----------------------------------------------------------------------------
// -----------------------------------------------------------------------------
uniform int u_Cell;
uniform int u_LastMoveFrom;
uniform int u_LastMoveTo;
uniform float u_Size;
uniform vec2 u_CellOrigin;
uniform vec4 u_Dark;
uniform vec4 u_Light;
uniform vec4 u_Highlight;

// -----------------------------------------------------------------------------
// -----------------------------------------------------------------------------
float plot( vec2 xy )
{
    return smoothstep( 0.0, 0.15, abs( fract( xy.x ) - fract( xy.y ) ) );
}

// -----------------------------------------------------------------------------
// -----------------------------------------------------------------------------
bool isDarkSquare( int squareIndex )
{
    int row = squareIndex / 8;
    int col = squareIndex % 8;
    return (row % 2 == col % 2);
}

// -----------------------------------------------------------------------------
// -----------------------------------------------------------------------------
void main()
{
    if ( isDarkSquare( u_Cell ) )
    {
        vec2 coord = vec2( gl_FragCoord ) - u_CellOrigin;
        coord = coord / u_Size;
        coord += 1.0f;
        coord *= 8.0f;
        float fac = plot( coord );
        color = (1.0f - fac) * u_Light + fac * u_Dark;
    }
    else
    {
        color = u_Light;
    }

    if ( u_Cell == u_LastMoveFrom || u_Cell == u_LastMoveTo )
        color = color * u_Highlight;
}

